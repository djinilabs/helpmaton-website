---
import Logo from "./Logo.astro";
---

<header
  class="header-glass sticky top-0 z-50 border-b border-neon-cyan/30 bg-surface/80 backdrop-blur-md shadow-neon-cyan"
  id="site-header"
>
  <div class="max-w-6xl mx-auto px-4 sm:px-8 py-4">
    <div class="flex items-center justify-between gap-2 min-w-0">
      <a
        href="/"
        class="flex items-center gap-2 sm:gap-3 hover:opacity-90 transition-opacity group min-w-0 flex-shrink"
      >
        <Logo class="w-9 h-9 sm:w-10 sm:h-10 flex-shrink-0 group-hover:scale-110 transition-transform header-logo" />
        <span
          class="text-lg sm:text-xl font-display font-bold bg-gradient-to-r from-neon-cyan to-neon-magenta bg-clip-text text-transparent truncate"
        >
          Helpmaton
        </span>
      </a>

      <nav class="hidden lg:flex flex-wrap items-center gap-1">
        <a
          href="/#use-cases"
          class="nav-link px-4 py-2 text-sm font-semibold text-neutral-300 hover:text-neon-cyan transition-colors rounded-lg hover:shadow-neon-cyan"
        >
          Use Cases
        </a>
        <a
          href="/#pricing"
          class="nav-link px-4 py-2 text-sm font-semibold text-neutral-300 hover:text-neon-cyan transition-colors rounded-lg hover:shadow-neon-cyan"
        >
          Pricing
        </a>
        <a
          href="/documentation"
          class="nav-link px-4 py-2 text-sm font-semibold text-neutral-300 hover:text-neon-cyan transition-colors rounded-lg hover:shadow-neon-cyan"
        >
          Documentation
        </a>
        <a
          href="/blog"
          class="nav-link px-4 py-2 text-sm font-semibold text-neutral-300 hover:text-neon-cyan transition-colors rounded-lg hover:shadow-neon-cyan"
        >
          Blog
        </a>
        <a
          href="/demos"
          class="nav-link px-4 py-2 text-sm font-semibold text-neutral-300 hover:text-neon-cyan transition-colors rounded-lg hover:shadow-neon-cyan"
        >
          Demos
        </a>
        <a
          class="header-login px-5 py-2 text-sm font-semibold text-surface bg-neon-cyan rounded-lg border border-neon-cyan/50 hover:shadow-neon-cyan-lg hover:border-neon-cyan transition-all hover:scale-105"
          href="https://app.helpmaton.com"
        >
          Login
        </a>
      </nav>

      <div class="flex lg:hidden items-center gap-2">
        <button
          type="button"
          class="flex items-center justify-center w-10 h-10 rounded-lg text-neutral-300 hover:bg-neon-cyan/10 hover:text-neon-cyan transition-colors"
          id="mobile-menu-button"
          aria-expanded="false"
          aria-controls="mobile-menu"
          aria-label="Open menu"
        >
          <span class="mobile-menu-icon flex flex-col gap-1.5" aria-hidden="true">
            <span class="block w-5 h-0.5 bg-current rounded-full origin-center transition-transform duration-200"></span>
            <span class="block w-5 h-0.5 bg-current rounded-full transition-opacity duration-200"></span>
            <span class="block w-5 h-0.5 bg-current rounded-full origin-center transition-transform duration-200"></span>
          </span>
        </button>
      </div>
    </div>

    <div
      id="mobile-menu"
      role="navigation"
      class="mobile-menu-panel lg:hidden overflow-hidden max-h-0 transition-all duration-200 ease-in-out border-t border-neon-cyan/20 -mx-4 sm:-mx-8 px-4 sm:px-8 bg-surface-100/95 backdrop-blur-md"
    >
      <nav class="flex flex-col py-4 gap-1">
        <a href="/#use-cases" class="mobile-menu-link px-4 py-3 text-sm font-semibold text-neutral-300 hover:text-neon-cyan rounded-lg hover:bg-neon-cyan/10">
          Use Cases
        </a>
        <a href="/#pricing" class="mobile-menu-link px-4 py-3 text-sm font-semibold text-neutral-300 hover:text-neon-cyan rounded-lg hover:bg-neon-cyan/10">
          Pricing
        </a>
        <a href="/documentation" class="mobile-menu-link px-4 py-3 text-sm font-semibold text-neutral-300 hover:text-neon-cyan rounded-lg hover:bg-neon-cyan/10">
          Documentation
        </a>
        <a href="/blog" class="mobile-menu-link px-4 py-3 text-sm font-semibold text-neutral-300 hover:text-neon-cyan rounded-lg hover:bg-neon-cyan/10">
          Blog
        </a>
        <a href="/demos" class="mobile-menu-link px-4 py-3 text-sm font-semibold text-neutral-300 hover:text-neon-cyan rounded-lg hover:bg-neon-cyan/10">
          Demos
        </a>
        <a
          class="header-login mobile-menu-link block text-center px-5 py-3 text-sm font-semibold text-surface bg-neon-cyan border border-neon-cyan/50 rounded-lg mt-2 hover:shadow-neon-cyan"
          href="https://app.helpmaton.com"
        >
          Login
        </a>
      </nav>
    </div>
  </div>
  <!-- Scroll progress line -->
  <div class="absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-neon-cyan to-neon-magenta origin-left scale-x-0 transition-transform duration-150 header-progress" id="header-progress" aria-hidden="true"></div>
</header>

<style>
  .header-glass {
    box-shadow: 0 0 20px rgba(0, 245, 255, 0.08);
  }
  .mobile-menu-panel.open {
    max-height: 80vh;
  }
  .mobile-menu-button-open .mobile-menu-icon span:first-child {
    transform: translateY(2px) rotate(45deg);
  }
  .mobile-menu-button-open .mobile-menu-icon span:nth-child(2) {
    opacity: 0;
  }
  .mobile-menu-button-open .mobile-menu-icon span:last-child {
    transform: translateY(-2px) rotate(-45deg);
  }
</style>

<script>
  document.querySelectorAll('.header-login').forEach((el) => {
    el.addEventListener('click', (e) => {
      if (window.posthog) {
        window.posthog.capture('login_clicked');
      }
      const href = (e.currentTarget as HTMLAnchorElement).href;
      e.preventDefault();
      setTimeout(() => { window.location.href = href; }, 150);
    });
  });

  const menuButton = document.getElementById('mobile-menu-button');
  const menuPanel = document.getElementById('mobile-menu');
  if (menuButton && menuPanel) {
    const btn = menuButton;
    const panel = menuPanel;
    const openClass = 'open';
    const buttonOpenClass = 'mobile-menu-button-open';

    function setOpen(open: boolean) {
      panel.classList.toggle(openClass, open);
      btn.classList.toggle(buttonOpenClass, open);
      btn.setAttribute('aria-expanded', String(open));
      btn.setAttribute('aria-label', open ? 'Close menu' : 'Open menu');
    }

    btn.addEventListener('click', () => {
      setOpen(!panel.classList.contains(openClass));
    });

    panel.querySelectorAll('.mobile-menu-link').forEach((link) => {
      link.addEventListener('click', () => setOpen(false));
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && panel.classList.contains(openClass)) {
        setOpen(false);
      }
    });
  }

  const progressBar = document.getElementById('header-progress');
  if (progressBar) {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!prefersReducedMotion) {
      window.addEventListener('scroll', () => {
        const scrollTop = window.scrollY;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const pct = docHeight > 0 ? Math.min(scrollTop / docHeight, 1) : 0;
        progressBar.style.transform = `scaleX(${pct})`;
      });
    }
  }
</script>
